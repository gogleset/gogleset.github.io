3:I[9275,[],""]
5:I[2864,["231","static/chunks/231-e841b6edcc38d627.js","613","static/chunks/app/posts/%5Bid%5D/error-43f6426e3a7526c8.js"],"default"]
6:I[1343,[],""]
7:I[8496,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"default"]
8:I[231,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],""]
9:I[6372,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"default"]
a:I[1842,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"default"]
b:I[6372,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"myDrawer3Close"]
c:I[1301,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"default"]
d:I[4404,["231","static/chunks/231-e841b6edcc38d627.js","185","static/chunks/app/layout-c5dcdd748a4b65d7.js"],"GoogleAnalytics"]
4:["id","nextImage","d"]
0:["DpO-zw4UfbWKBovr8Y_Wh",[[["",{"children":["posts",{"children":[["id","nextImage","d"],{"children":["__PAGE__?{\"id\":\"nextImage\"}",{}]}]}]},"$undefined","$undefined",true],["",{"children":["posts",{"children":[["id","nextImage","d"],{"children":["__PAGE__",{},[["$L1","$L2"],null],null]},[["$","div",null,{"className":"flex flex-col w-full","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children","$4","children"],"error":"$5","errorStyles":[],"errorScripts":[],"template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}]}],null],null]},["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children","posts","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","notFoundStyles":"$undefined","styles":null}],null]},[["$","html",null,{"lang":"ko","data-theme":"cupcake","children":[["$","body",null,{"children":["$","$L7",null,{"children":[["$","header",null,{"className":" border-gray-200 px-4 lg:px-6 py-3.5  max-h-[68px] w-full sticky top-0 bg-base-100","children":["$","div",null,{"className":"w-full max-w-[1140px] mx-auto","children":[["$","div",null,{"className":"flex flex-wrap justify-between items-center ","children":[["$","div",null,{"className":"flex gap-3 items-center","children":[["$","$L8",null,{"href":"/","className":"self-center text-xl font-semibold whitespace-nowrap cursor-pointer","children":"gogleset's note"}],["$","div",null,{"className":"divider divider-horizontal w-2 max-lg:hidden"}],["$","nav",null,{"className":"max-lg:hidden","children":["$","$L9",null,{}]}]]}],["$","div",null,{"className":"flex gap-4 items-center justify-center","children":[["$","div",null,{"className":"flex max-lg:hidden","children":["$","$La",null,{}]}],["$","div",null,{"className":"drawer drawer-end lg:hidden","children":[["$","input",null,{"id":"my-drawer-3","type":"checkbox","className":"drawer-toggle"}],["$","div",null,{"className":"drawer-content flex flex-col","children":["$","div",null,{"className":" w-full p-0","children":["$","div",null,{"className":"lg:hidden","children":["$","label",null,{"htmlFor":"my-drawer-3","aria-label":"open sidebar","className":"cursor-pointer","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","className":"inline-block w-8 h-8 stroke-current","children":["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","strokeWidth":"2","d":"M4 6h16M4 12h16M4 18h16"}]}]}]}]}]}],["$","div",null,{"className":"drawer-side","children":[["$","label",null,{"htmlFor":"my-drawer-3","aria-label":"close sidebar","className":"drawer-overlay"}],["$","div",null,{"className":"menu p-4 w-80 min-h-full bg-base-200 justify-between","children":[["$","$L9",null,{"col":true}],["$","div",null,{"className":"flex justify-between","children":[["$","svg",null,{"onClick":"$b","className":"fill-current cursor-pointer","xmlns":"http://www.w3.org/2000/svg","width":"40","height":"40","viewBox":"0 0 512 512","children":["$","polygon",null,{"points":"400 145.49 366.51 112 256 222.51 145.49 112 112 145.49 222.51 256 112 366.51 145.49 400 256 289.49 366.51 400 400 366.51 289.49 256 400 145.49"}]}],["$","$La",null,{}]]}]]}]]}]]}]]}]]}],["$","$Lc",null,{}]]}]}],["$","main",null,{"className":"flex w-full justify-center items-center flex-col","children":["$","article",null,{"className":"flex justify-center w-full max-w-[1080px] p-5","children":["$","$L3",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L6",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":["$","section",null,{"children":["$","div",null,{"className":"container flex pt-32 min-h-screen  mx-auto","children":["$","div",null,{"className":"flex flex-col items-center max-w-sm mx-auto text-center","children":[["$","p",null,{"className":"p-3 text-sm font-medium text-current rounded-full  ","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","fill":"none","viewBox":"0 0 24 24","strokeWidth":"2","stroke":"currentColor","className":"w-6 h-6","children":["$","path",null,{"strokeLinecap":"round","strokeLinejoin":"round","d":"M12 9v3.75m9-.75a9 9 0 11-18 0 9 9 0 0118 0zm-9 3.75h.008v.008H12v-.008z"}]}]}],["$","p",null,{"className":"mt-3 text-2xl font-semibold md:text-3xl","children":"OOPS! "}],["$","h1",null,{"className":"mt-1 text-xl font-semibold","children":"404 page not found"}],["$","$L8",null,{"href":"/","className":"mt-10 btn btn-success","children":"Home"}]]}]}]}],"notFoundStyles":[],"styles":null}]}]}],["$","div",null,{"className":"w-full h-32","children":["$","footer",null,{"className":"footer footer-center p-10 justify-center","children":["$","nav",null,{"children":["$","div",null,{"className":"grid grid-flow-col gap-7","children":[["$","a",null,{"title":"github","target":"_blank","href":"https://github.com/gogleset","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":"24","height":"24","viewBox":"0 0 24 24","className":"fill-current","children":["$","path",null,{"d":"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"}]}]}],["$","a",null,{"title":"email","target":"_blank","href":"mailto:choij2494@gmail.com","children":["$","svg",null,{"xmlns":"http://www.w3.org/2000/svg","width":"24","height":"24","viewBox":"0 0 75.294 75.294","className":"fill-current","children":["$","path",null,{"d":"M66.097,12.089h-56.9C4.126,12.089,0,16.215,0,21.286v32.722c0,5.071,4.126,9.197,9.197,9.197h56.9   c5.071,0,9.197-4.126,9.197-9.197V21.287C75.295,16.215,71.169,12.089,66.097,12.089z M61.603,18.089L37.647,33.523L13.691,18.089   H61.603z M66.097,57.206h-56.9C7.434,57.206,6,55.771,6,54.009V21.457l29.796,19.16c0.04,0.025,0.083,0.042,0.124,0.065   c0.043,0.024,0.087,0.047,0.131,0.069c0.231,0.119,0.469,0.215,0.712,0.278c0.025,0.007,0.05,0.01,0.075,0.016   c0.267,0.063,0.537,0.102,0.807,0.102c0.001,0,0.002,0,0.002,0c0.002,0,0.003,0,0.004,0c0.27,0,0.54-0.038,0.807-0.102   c0.025-0.006,0.05-0.009,0.075-0.016c0.243-0.063,0.48-0.159,0.712-0.278c0.044-0.022,0.088-0.045,0.131-0.069   c0.041-0.023,0.084-0.04,0.124-0.065l29.796-19.16v32.551C69.295,55.771,67.86,57.206,66.097,57.206z"}]}]}]]}]}]}]}]]}]}],["$","$Ld",null,{"gaId":"$undefined"}]]}],null],[["$","div",null,{"className":"flex pt-1 min-h-screen","children":["$","div",null,{"className":"loading loading-infinity loading-lg "}]}],[],[]]],[[["$","link","0",{"rel":"stylesheet","href":"https://gogleset.github.io/_next/static/css/cc4162795b3fa97e.css","precedence":"next","crossOrigin":"$undefined"}]],"$Le"]]]]
f:I[3556,["173","static/chunks/173-085cf89c21a1457b.js","722","static/chunks/app/posts/%5Bid%5D/page-ed3992e816e0c12e.js"],"default"]
2:[[["$","div",null,{"className":"flex flex-col items-center justify-center h-64 gap-3","children":[["$","h1",null,{"className":"text-3xl max-lg:text-2xl font-bold text-center","children":"Next.js Image 어떻게 최적화 할까?"}],["$","div",null,{"className":"flex flex-col items-center justify-center gap-1","children":[["$","span",null,{"className":"text-gray","children":"2025-04-23"}],["$","div",null,{"className":"flex gap-1 ","children":[["$","span","Next_0",{"className":"badge badge-accent","children":"Next"}],["$","span","Image_1",{"className":"badge badge-accent","children":"Image"}]]}]]}]]}],["$","hr",null,{"className":"mb-[0px]"}]],["$","div",null,{"className":"flex flex-col prose max-w-full max-sm:prose-sm ","children":[["$","h1",null,{"id":"toc","children":"toc"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","a",null,{"href":"#nextjs-image-%EC%B5%9C%EC%A0%81%ED%99%94","children":"Next.js Image 최적화"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%99%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94%EA%B0%80","children":"왜 사용하는가?"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%ED%8F%AC%EB%A7%B7-%EB%B9%84%EA%B5%90-%ED%91%9C","children":"이미지 포맷 비교 표"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%B0%B8%EA%B3%A0-mime-type-vs-content-type","children":"참고) MIME Type vs Content-Type"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#nextjs-image-%EC%9A%94%EC%B2%AD-%EC%B2%98%EB%A6%AC-%ED%9D%90%EB%A6%84","children":"Next.js Image 요청 처리 흐름"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%A3%BC%EC%9A%94-%ED%8C%8C%EC%9D%BC","children":"주요 파일"}]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#server","children":"Server"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","a",null,{"href":"#image-optimizerts","children":"image-optimizer.ts"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%A7%80%EC%9B%90%ED%95%98%EB%8A%94-%ED%98%95%EC%8B%9D%EC%9C%BC%EB%A1%9C%EC%9D%98-%ED%8F%AC%EB%A7%B7-%EB%B3%80%ED%99%98","children":"지원하는 형식으로의 포맷 변환"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%A3%BC%EC%9A%94-%EC%B2%98%EB%A6%AC","children":"이미지 최적화 주요 처리"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#nextjs%EA%B0%80-%EA%B4%80%EB%A6%AC%ED%95%98%EB%8A%94-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%86%8D%EC%84%B1%EA%B0%92%EB%93%A4","children":"Next.js가 관리하는 이미지 속성값들"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%A7%80%EC%9B%90%EB%90%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EC%9D%B4%EB%AF%B8%EC%A7%80","children":"지원되지 않는 이미지"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#contenttype-%EA%B2%B0%EC%A0%95","children":"contentType 결정"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94","children":"이미지 최적화"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%A3%BC%EC%9A%94-%EC%B2%98%EB%A6%AC","children":"주요 처리:"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%8B%A4%ED%97%98%EC%A0%81-%EC%98%B5%EC%85%98sharp%EC%97%90%EC%84%9C-%EC%A7%80%EC%9B%90","children":"실험적 옵션(sharp에서 지원)"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#%EC%BA%90%EC%8B%B1-%EC%B2%98%EB%A6%AC","children":"캐싱 처리"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%BA%90%EC%8B%9C-%EC%A0%80%EC%9E%A5-%EB%B0%A9%EC%8B%9D","children":"캐시 저장 방식"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#next-serverts","children":"next-server.ts"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#handlenextimagerequest%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%9A%94%EC%B2%AD-%ED%95%B8%EB%93%A4%EB%9F%AC","children":"handleNextImageRequest(이미지 요청 핸들러)"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#%EC%9D%B4%EB%AF%B8%EC%A7%80-%EC%B5%9C%EC%A0%81%ED%99%94-%EC%BA%90%EC%8B%9C-%ED%81%B4%EB%9E%98%EC%8A%A4","children":"이미지 최적화 캐시 클래스"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#imageoptimizer","children":"imageOptimizer"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#client","children":"Client"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","a",null,{"href":"#image-externalts","children":"image-external.ts"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#defaultloader","children":"defaultLoader"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#getimgprops","children":"getImgProps"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#generateattrs","children":"generateAttrs"}]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","a",null,{"href":"#image","children":"<Image/>"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["$","a",null,{"href":"#image-%EC%BA%90%EC%8B%B1-%EC%A0%95%EC%B1%85","children":"Image 캐싱 정책"}]}],"\n",["$","li",null,{"children":["$","a",null,{"href":"#vercel-%EB%B0%B0%ED%8F%AC-%EC%8B%9C-%EC%A3%BC%EC%9D%98%EC%A0%9020254%EC%9B%94-%EA%B8%B0%EC%A4%80","children":"Vercel 배포 시 주의점(2025.4월 기준)"}]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","h1",null,{"id":"nextjs-image-최적화","children":"Next.js Image 최적화"}],"\n",["$","p",null,{"children":"(2025.4 Canary 버전 기준)"}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"왜-사용하는가","children":"왜 사용하는가?"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"크기 최적화"}],": 웹 친화적인 이미지 포맷으로 변환 (AVIF, WEBP 등)"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"이미지-포맷-비교-표","children":"이미지 포맷 비교 표"}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"특성"}],["$","th",null,{"children":"AVIF"}],["$","th",null,{"children":"JPG/JPEG"}],["$","th",null,{"children":"PNG"}],["$","th",null,{"children":"WebP"}],["$","th",null,{"children":"MozJPEG"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":"개발자"}],["$","td",null,{"children":"Alliance for Open Media"}],["$","td",null,{"children":"Joint Photographic Experts Group"}],["$","td",null,{"children":"PNG Development Group"}],["$","td",null,{"children":"Google"}],["$","td",null,{"children":"Mozilla"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"압축 방식"}],["$","td",null,{"children":"손실/무손실"}],["$","td",null,{"children":"손실"}],["$","td",null,{"children":"무손실"}],["$","td",null,{"children":"손실/무손실"}],["$","td",null,{"children":"손실"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"파일 크기"}],["$","td",null,{"children":"매우 작음"}],["$","td",null,{"children":"중간"}],["$","td",null,{"children":"큼"}],["$","td",null,{"children":"작음"}],["$","td",null,{"children":"중간-작음"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"이미지 품질"}],["$","td",null,{"children":"매우 높음"}],["$","td",null,{"children":"중간-높음"}],["$","td",null,{"children":"매우 높음"}],["$","td",null,{"children":"높음"}],["$","td",null,{"children":"높음"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"투명도 지원"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"미지원"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"미지원"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"애니메이션"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"미지원"}],["$","td",null,{"children":"미지원(APNG 제외)"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"미지원"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"브라우저 호환성"}],["$","td",null,{"children":"제한적"}],["$","td",null,{"children":"매우 높음"}],["$","td",null,{"children":"매우 높음"}],["$","td",null,{"children":"높음"}],["$","td",null,{"children":"매우 높음"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"적합한 용도"}],["$","td",null,{"children":"웹 이미지, 사진"}],["$","td",null,{"children":"사진, 웹 이미지"}],["$","td",null,{"children":"로고, 아이콘, 스크린샷"}],["$","td",null,{"children":"웹 이미지, 애니메이션"}],["$","td",null,{"children":"최적화된 웹 사진"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"색상 깊이"}],["$","td",null,{"children":"8-12비트"}],["$","td",null,{"children":"8비트"}],["$","td",null,{"children":"8-16비트"}],["$","td",null,{"children":"8비트"}],["$","td",null,{"children":"8비트"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"HDR 지원"}],["$","td",null,{"children":"지원"}],["$","td",null,{"children":"미지원"}],["$","td",null,{"children":"미지원"}],["$","td",null,{"children":"제한적"}],["$","td",null,{"children":"미지원"}]]}]]}]]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"웹사이트 성능 최적화: AVIF나 WebP"}],"\n",["$","li",null,{"children":"호환성: JPG나 PNG"}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"참고-mime-type-vs-contenttype","children":"참고) MIME Type vs Content-Type"}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"항목"}],["$","th",null,{"children":"MIME 타입"}],["$","th",null,{"children":"Content-Type"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":"정의"}],["$","td",null,{"children":"파일 형식 식별을 위한 표준"}],["$","td",null,{"children":"HTTP 응답의 리소스 타입 명시"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"사용 범위"}],["$","td",null,{"children":"이메일, 웹, 프로그램 등 광범위"}],["$","td",null,{"children":"HTTP 통신에서 주로 사용"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"포함 정보"}],["$","td",null,{"children":["타입/서브타입 (예: ",["$","code",null,{"children":"text/html"}],")"]}],["$","td",null,{"children":"MIME 타입 + 선택 파라미터"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"예시"}],["$","td",null,{"children":["$","code",null,{"children":"image/jpeg"}]}],["$","td",null,{"children":["$","code",null,{"children":"Content-Type: image/jpeg; charset=UTF-8"}]}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"독립성"}],["$","td",null,{"children":"다양한 프로토콜에서 사용"}],["$","td",null,{"children":"HTTP 헤더의 일부로 한정"}]]}]]}]]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"id":"nextjs-image-요청-처리-흐름","children":"Next.js Image 요청 처리 흐름"}],"\n",["$","ol",null,{"children":["\n",["$","li",null,{"children":["브라우저가 ",["$","code",null,{"children":"/_next/image/..."}]," 경로로 요청"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"handleNextImageRequest"}],"에서 요청 라우팅"]}],"\n",["$","li",null,{"children":"파라미터 검증 및 캐시 확인"}],"\n",["$","li",null,{"children":"캐시가 있다면 반환"}],"\n",["$","li",null,{"children":["없다면 ",["$","code",null,{"children":"imageOptimizer"}]," 호출하여 최적화 수행 후 캐시에 저장"]}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h1",null,{"id":"주요-파일","children":"주요 파일"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"next-server.ts (server)"}],"\n",["$","li",null,{"children":"image-optimizer.ts (server)"}],"\n",["$","li",null,{"children":"image-external.ts (client)"}],"\n",["$","li",null,{"children":"image-component.ts(client)"}],"\n"]}],"\n",["$","h1",null,{"id":"server","children":"Server"}],"\n",["$","h2",null,{"id":"imageoptimizerts","children":"image-optimizer.ts"}],"\n",["$","h3",null,{"id":"지원하는-형식으로의-포맷-변환","children":"지원하는 형식으로의 포맷 변환"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"getSupportedMimeType"}],["$","span",null,{"className":"token punctuation","children":"("}],"options",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"string"}],["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":","}]," accept ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"\""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," mimeType ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"mediaType"}],["$","span",null,{"className":"token punctuation","children":"("}],"accept",["$","span",null,{"className":"token punctuation","children":","}]," options",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," accept",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"includes"}],["$","span",null,{"className":"token punctuation","children":"("}],"mimeType",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"?"}]," mimeType ",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," mimeType ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"getSupportedMimeType"}],["$","span",null,{"className":"token punctuation","children":"("}],"formats ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":","}]," req",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"headers"}],["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"accept\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"header에서 accept를 추출하여 브라우저에서 지원하는 값을 추출하고, 이 options 는"}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"/** @type {import('next').NextConfig} */"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," nextConfig ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  images",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    formats",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token string","children":"\"image/avif\""}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"\"image/webp\""}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"default"}]," nextConfig",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["여기 작성한 formats 옵션이 들어간다. 기본값은 ",["$","a",null,{"href":"https://github.com/vercel/next.js/blob/canary/packages/next/src/server/image-optimizer.ts#L220","children":"[image/webp]"}],"이다. 지원하지 않으면 원본 포맷을 유지한다."]}],"\n"]}],"\n",["$","h2",null,{"id":"이미지-최적화-주요-처리","children":"이미지 최적화 주요 처리"}],"\n",["$","h3",null,{"id":"nextjs가-관리하는-이미지-속성값들","children":"Next.js가 관리하는 이미지 속성값들"}],"\n",["$","pre",null,{"className":"language-ts","children":["$","code",null,{"className":"language-ts code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"AVIF"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/avif\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"WEBP"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/webp\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"PNG"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/png\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"JPEG"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/jpeg\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"GIF"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/gif\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"SVG"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/svg+xml\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"ICO"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/x-icon\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"ICNS"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/x-icns\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"TIFF"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/tiff\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"BMP"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token string","children":"\"image/bmp\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"ANIMATABLE_TYPES"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token constant","children":"WEBP"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token constant","children":"PNG"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token constant","children":"GIF"}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// 움직일만한 타입(PNG는 APNG라는 포맷이 있다.)"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"BYPASS_TYPES"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token constant","children":"SVG"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token constant","children":"ICO"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token constant","children":"ICNS"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token constant","children":"BMP"}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}]," ",["$","span",null,{"className":"token comment","children":"// 최적화 안해주는 타입들"}],"\n"]}]]}]}],"\n",["$","h3",null,{"id":"지원되지-않는-이미지","children":"지원되지 않는 이미지"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"upstreamType",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"startsWith"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"image/svg\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"nextConfig",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"images"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"dangerouslyAllowSVG"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["SVG는 ",["$","code",null,{"children":"dangerouslyAllowSVG"}]," 설정이 꺼져 있으면 에러 반환"]}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token constant","children":"ANIMATABLE_TYPES"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"includes"}],["$","span",null,{"className":"token punctuation","children":"("}],"upstreamType",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," ",["$","span",null,{"className":"token function","children":"isAnimated"}],["$","span",null,{"className":"token punctuation","children":"("}],"upstreamBuffer",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"애니메이션 이미지(WEBP, PNG(APNG), GIF)는 최적화하지 않고 원본 반환"}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token constant","children":"BYPASS_TYPES"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"includes"}],["$","span",null,{"className":"token punctuation","children":"("}],"upstreamType",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"최적화 대상에서 제외 (SVG, ICO, ICNS, BMP 등)"}],"\n"]}],"\n",["$","h3",null,{"id":"contenttype-결정","children":"contentType 결정"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"let"}]," contentType ",["$","span",null,{"className":"token operator","children":"="}]," mimeType ",["$","span",null,{"className":"token operator","children":"??"}]," upstreamType ",["$","span",null,{"className":"token operator","children":"??"}]," ",["$","span",null,{"className":"token constant","children":"JPEG"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"MIME 타입 > upstreamType > 기본값 JPEG 순서로 지정"}],"\n"]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"이미지-최적화","children":"이미지 최적화"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"let"}]," optimizedBuffer ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token function","children":"optimizeImage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  buffer",["$","span",null,{"className":"token operator","children":":"}]," upstreamBuffer",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  contentType",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  quality",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  width",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  concurrency",["$","span",null,{"className":"token operator","children":":"}]," nextConfig",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"experimental"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imgOptConcurrency"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  limitInputPixels",["$","span",null,{"className":"token operator","children":":"}]," nextConfig",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"experimental"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imgOptMaxInputPixels"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  sequentialRead",["$","span",null,{"className":"token operator","children":":"}]," nextConfig",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"experimental"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imgOptSequentialRead"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  timeoutInSeconds",["$","span",null,{"className":"token operator","children":":"}]," nextConfig",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"experimental"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imgOptTimeoutInSeconds"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  buffer",["$","span",null,{"className":"token operator","children":":"}]," optimizedBuffer",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  contentType",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  maxAge",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  etag",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token function","children":"getImageEtag"}],["$","span",null,{"className":"token punctuation","children":"("}],"optimizedBuffer",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  upstreamEtag",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"optimizedBuffer를 받게된다."}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"async"}]," ",["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"optimizeImage"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token spread operator","children":"..."}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token spread operator","children":"..."}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]}]}],"\n",["$","h3",null,{"id":"주요-처리","children":"주요 처리:"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"sharp"}]," 라이브러리 사용(squoosh는 제외됨)"]}],"\n",["$","li",null,{"children":["사이즈 조절: ",["$","code",null,{"children":"resize(width, height)"}]]}],"\n",["$","li",null,{"children":["포맷별 설정:","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["AVIF: ",["$","code",null,{"children":"quality - 20"}],", ",["$","code",null,{"children":"effort: 3"}]]}],"\n",["$","li",null,{"children":"WEBP, PNG, JPEG: 각 포맷에 맞는 옵션 적용"}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":"최종 버퍼 반환"}],"\n"]}],"\n",["$","h3",null,{"id":"실험적-옵션sharp에서-지원","children":"실험적 옵션(sharp에서 지원)"}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"옵션명"}],["$","th",null,{"children":"설명"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"concurrency"}]}],["$","td",null,{"children":"동시 최적화 제한"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"limitInputPixels"}]}],["$","td",null,{"children":"입력 이미지 픽셀 제한"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"sequentialRead"}]}],["$","td",null,{"children":"순차 읽기 활성화 여부"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":["$","code",null,{"children":"timeoutInSeconds"}]}],["$","td",null,{"children":"최적화 타임아웃 설정"}]]}]]}]]}],"\n",["$","hr",null,{}],"\n",["$","h2",null,{"id":"캐싱-처리","children":"캐싱 처리"}],"\n",["$","h3",null,{"id":"캐시-저장-방식","children":"캐시 저장 방식"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"async"}]," ",["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"writeToCacheDir"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," filename ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"join"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["    dir",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"maxAge",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"."}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"expireAt",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"."}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"etag",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"."}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"upstreamEtag",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"."}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"extension",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token spread operator","children":"..."}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," promises",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"writeFile"}],["$","span",null,{"className":"token punctuation","children":"("}],"filename",["$","span",null,{"className":"token punctuation","children":","}]," buffer",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"이미지 캐시 파일명은 정보 기반으로 구성"}],"\n"]}],"\n",["$","h2",null,{"id":"nextserverts","children":"next-server.ts"}],"\n",["$","h3",null,{"id":"handlenextimagerequest이미지-요청-핸들러","children":"handleNextImageRequest(이미지 요청 핸들러)"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":["\t ",["$","span",null,{"className":"token comment","children":"// URL 경로가 없거나 '/_next/image'로 시작하지 않으면 처리하지 않음"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token operator","children":"!"}],"parsedUrl",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"pathname"}]," ",["$","span",null,{"className":"token operator","children":"||"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"parsedUrl",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"pathname"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"startsWith"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"'/_next/image'"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"false"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// 미들웨어 요청이면 처리하지 않음"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token function","children":"getRequestMeta"}],["$","span",null,{"className":"token punctuation","children":"("}],"req",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token string","children":"'middlewareInvoke'"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token boolean","children":"false"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["     ",["$","span",null,{"className":"token comment","children":"// 최소 모드이거나 정적 내보내기 모드일 경우 이미지 최적화를 처리하지 않고 400 오류 반환"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"minimalMode"}]," ",["$","span",null,{"className":"token operator","children":"||"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"nextConfig"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"output"}]," ",["$","span",null,{"className":"token operator","children":"==="}]," ",["$","span",null,{"className":"token string","children":"'export'"}]," ",["$","span",null,{"className":"token operator","children":"||"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      process",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"env"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"NEXT_MINIMAL"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]]}]}],"\n",["$","h3",null,{"id":"이미지-최적화-캐시-클래스","children":"이미지 최적화 캐시 클래스"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," imageOptimizerCache ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"new"}]," ",["$","span",null,{"className":"token class-name","children":"ImageOptimizerCache"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  distDir",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"distDir"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  nextConfig",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"nextConfig"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"최적화된 이미지가 저장되는 디렉토리를 관리하는 클래스"}],"\n",["$","li",null,{"children":"이미지 최적화 캐시 인스턴스 생성"}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," paramsResult ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageOptimizerCache"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"validateParams"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," cacheKey ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageOptimizerCache"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"getCacheKey"}],["$","span",null,{"className":"token punctuation","children":"("}],"paramsResult",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"이미지 최적화 캐시 클래스에서 이미지 검증과 캐시 키를 가져옴"}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":["   ",["$","span",null,{"className":"token keyword","children":"const"}]," cacheEntry ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imageResponseCache"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"get"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["          cacheKey",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["          ",["$","span",null,{"className":"token keyword","children":"async"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}]," previousCacheEntry ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            ",["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," buffer",["$","span",null,{"className":"token punctuation","children":","}]," contentType",["$","span",null,{"className":"token punctuation","children":","}]," maxAge",["$","span",null,{"className":"token punctuation","children":","}]," upstreamEtag",["$","span",null,{"className":"token punctuation","children":","}]," etag ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token operator","children":"="}],"\n"]}],["$","span",null,{"className":"code-line","children":["              ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"imageOptimizer"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["              ",["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":["              ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["         ",["$","span",null,{"className":"token spread operator","children":"..."}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["          ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["            routeKind",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"RouteKind"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"IMAGE"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            incrementalCache",["$","span",null,{"className":"token operator","children":":"}]," imageOptimizerCache",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            isFallback",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token boolean","children":"false"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["          ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}]]}]}],"\n",["$","hr",null,{}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token operator","children":"!"}],"key",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token function","children":"responseGenerator"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}]," hasResolved",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token boolean","children":"false"}],["$","span",null,{"className":"token punctuation","children":","}]," previousCacheEntry",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"null"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"이런식으로 imageOtimizer를 this.imageResponseCache.get에서 활용하고 있다."}],"\n"]}],"\n",["$","h2",null,{"id":"imageoptimizer","children":"imageOptimizer"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"protected"}]," ",["$","span",null,{"className":"token keyword","children":"async"}]," ",["$","span",null,{"className":"token function","children":"imageOptimizer"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token spread operator","children":"..."}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["\t\t\t\t",["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":["\t\t\t\t",["$","span",null,{"className":"token comment","children":"// 절대 루트인지 확인해서 외부 이미지, 내부이미지 구분"}],"\n"]}],["$","span",null,{"className":"code-line","children":["\t\t\t",["$","span",null,{"className":"token keyword","children":"const"}]," imageUpstream ",["$","span",null,{"className":"token operator","children":"="}]," isAbsolute\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token operator","children":"?"}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token function","children":"fetchExternalImage"}],["$","span",null,{"className":"token punctuation","children":"("}],"href",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"await"}]," ",["$","span",null,{"className":"token function","children":"fetchInternalImage"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["            href",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            req",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"originalRequest"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["            res",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"originalResponse"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":"            handleInternalReq\n"}],["$","span",null,{"className":"code-line","children":["          ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["\t\t\t\t",["$","span",null,{"className":"token comment","children":"//image-optimizer.ts에 있는 함수"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token function","children":"imageOptimizer"}],["$","span",null,{"className":"token punctuation","children":"("}],"imageUpstream",["$","span",null,{"className":"token punctuation","children":","}]," paramsResult",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"nextConfig"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["        isDev",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"this"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"renderOpts"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"dev"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["        previousCacheEntry",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["외부 URL → ",["$","code",null,{"children":"fetchExternalImage(href)"}]]}],"\n",["$","li",null,{"children":["내부 URL → ",["$","code",null,{"children":"fetchInternalImage(...)"}]]}],"\n",["$","li",null,{"children":"이후 최적화 수행 및 캐시 저장"}],"\n"]}],"\n",["$","h1",null,{"id":"client","children":"Client"}],"\n",["$","h2",null,{"id":"imageexternalts","children":"image-external.ts"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"getImageProps"}],["$","span",null,{"className":"token punctuation","children":"("}],"imgProps",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageProps"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"default"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Image"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"type"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageProps"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageLoaderProps"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageLoader"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token maybe-class-name","children":"StaticImageData"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"기본적으로 Image 컴포넌트를 내보내고, 타입과 getImageProps 함수를 내보낸다."}],"\n"]}],"\n",["$","h3",null,{"id":"defaultloader","children":"defaultLoader"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"next image의 src path 리턴"}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"import"}]," ",["$","span",null,{"className":"token keyword","children":"type"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageLoaderPropsWithConfig"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token keyword","children":"from"}]," ",["$","span",null,{"className":"token string","children":"\"./image-config\""}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"75"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"defaultLoader"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  config",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  src",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  width",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  quality",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImageLoaderPropsWithConfig"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"string"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// 이미지 유효성 확인 로직"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," q ",["$","span",null,{"className":"token operator","children":"="}],"\n"]}],["$","span",null,{"className":"code-line","children":["    quality ",["$","span",null,{"className":"token operator","children":"||"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// image 퀄리티를 제한하려면 next.config에 구성을 추가할 수 있습니다."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    config",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"qualities"}],["$","span",null,{"className":"token operator","children":"?."}],["$","span",null,{"className":"token method function property-access","children":"reduce"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"prev",["$","span",null,{"className":"token punctuation","children":","}]," cur",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"cur ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"<"}]," ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"prev ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"?"}]," cur ",["$","span",null,{"className":"token operator","children":":"}]," prev\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"||"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"config",["$","span",null,{"className":"token punctuation","children":"."}],"path",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"?url="}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],["$","span",null,{"className":"token function","children":"encodeURIComponent"}],["$","span",null,{"className":"token punctuation","children":"("}],"src",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"&w="}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"width",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":"&q="}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"q",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"\n"]}]]}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token template-string","children":["$","span",null,{"className":"token interpolation","children":["    src",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token function","children":"startsWith"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\"/_next/static/media/\""}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"&&"}]," process",["$","span",null,{"className":"token punctuation","children":"."}],"env",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"NEXT_DEPLOYMENT_ID"}],"\n"]}]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token template-string","children":["$","span",null,{"className":"token interpolation","children":["      ",["$","span",null,{"className":"token operator","children":"?"}]," ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token string","children":"&dpl="}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"process",["$","span",null,{"className":"token punctuation","children":"."}],"env",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token constant","children":"NEXT_DEPLOYMENT_ID"}],["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],"\n"]}]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token template-string","children":["$","span",null,{"className":"token interpolation","children":["      ",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"\"\""}],"\n"]}]}]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token interpolation","children":["  ",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"// We use this to determine if the import is the default loader"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"// or a custom loader defined by the user in next.config.js"}],"\n"]}],["$","span",null,{"className":"code-line","children":["defaultLoader",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"__next_img_default"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token boolean","children":"true"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"default"}]," defaultLoader",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["사용자가 직접 ",["$","code",null,{"children":"quality"}],"를 지정했다면 그걸 쓰고, 지정 안 했다면 ",["$","code",null,{"children":"config.qualities"}]," 목록에서 75와 가장 가까운 걸 골라서 쓰고, 그것도 없으면 기본값인 ",["$","code",null,{"children":"75"}],"를 사용한다."]}],"\n"]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token number","children":"75"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," qualities ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token number","children":"60"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token number","children":"70"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token number","children":"80"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token number","children":"90"}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," closestQuality ",["$","span",null,{"className":"token operator","children":"="}]," qualities",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"reduce"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"prev",["$","span",null,{"className":"token punctuation","children":","}]," cur",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," prevDiff ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"prev ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," curDiff ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"cur ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"cur ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"<"}]," ",["$","span",null,{"className":"token known-class-name class-name","children":"Math"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"abs"}],["$","span",null,{"className":"token punctuation","children":"("}],"prev ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token constant","children":"DEFAULT_Q"}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":"?"}]," cur ",["$","span",null,{"className":"token operator","children":":"}]," prev",["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token console class-name","children":"console"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"log"}],["$","span",null,{"className":"token punctuation","children":"("}],"closestQuality",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"확인해보기"}],"\n"]}],"\n",["$","h2",null,{"id":"getimgprops","children":"getImgProps"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"getImgProps"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],["$","span",null,{"className":"token maybe-class-name","children":"ImageProps"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}]," _state",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    props",["$","span",null,{"className":"token operator","children":":"}]," 실제 ",["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token punctuation","children":"<"}],"img"]}],["$","span",null,{"className":"token punctuation","children":">"}]]}],["$","span",null,{"className":"token plain-text","children":" 태그에 들어갈 최종 속성들,\n"}]]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token plain-text","children":"    meta: "}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      unoptimized",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"boolean"}]," ",["$","span",null,{"className":"token comment","children":"// 최적화 비활성화 여부"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      priority",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"boolean"}]," ",["$","span",null,{"className":"token comment","children":"// 우선 로딩 여부"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      placeholder",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token string","children":"'blur'"}]," ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token string","children":"'empty'"}]," ",["$","span",null,{"className":"token comment","children":"// 플레이스홀더 타입"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      fill",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token builtin","children":"boolean"}]," ",["$","span",null,{"className":"token comment","children":"// 부모 요소에 맞게 꽉 채울지 여부"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token plain-text","children":"\n"}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token plain-text","children":"  }\n"}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token plain-text","children":"}\n"}]}]]}]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token comment","children":"// 예외 처리 및 이미지 스타일, 백그라운드 이미지, 사이즈 속성이 설정된 후"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," imgAttributes ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"generateImgAttrs"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  config",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  src",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  unoptimized",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  width",["$","span",null,{"className":"token operator","children":":"}]," widthInt",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  quality",["$","span",null,{"className":"token operator","children":":"}]," qualityInt",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  sizes",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  loader",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"Image의 src, sizes, srcSet을 결정하는 generateImgAttrs를 통과한다."}],"\n"]}],"\n",["$","h3",null,{"id":"generateattrs","children":"generateAttrs"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"function"}]," ",["$","span",null,{"className":"token function","children":"generateImgAttrs"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  config",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  src",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  unoptimized",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  width",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  quality",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  sizes",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  loader",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"GenImgAttrsData"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"GenImgAttrsResult"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"if"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"unoptimized",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," src",["$","span",null,{"className":"token punctuation","children":","}]," srcSet",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"undefined"}],["$","span",null,{"className":"token punctuation","children":","}]," sizes",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"undefined"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// size가 있는 경우 sizes 또는 width 값을 기준으로 적절한 width 목록을 계산"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// width가 있는 경우, kind:x (배율계산)"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// size, width가 없다면 deviceSize를 씀"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," widths",["$","span",null,{"className":"token punctuation","children":","}]," kind ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"getWidths"}],["$","span",null,{"className":"token punctuation","children":"("}],"config",["$","span",null,{"className":"token punctuation","children":","}]," width",["$","span",null,{"className":"token punctuation","children":","}]," sizes",["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"const"}]," last ",["$","span",null,{"className":"token operator","children":"="}]," widths",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"length"}]," ",["$","span",null,{"className":"token operator","children":"-"}]," ",["$","span",null,{"className":"token number","children":"1"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token comment","children":"// kind는 w(width), x(배율)"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    sizes",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token operator","children":"!"}],"sizes ",["$","span",null,{"className":"token operator","children":"&&"}]," kind ",["$","span",null,{"className":"token operator","children":"==="}]," ",["$","span",null,{"className":"token string","children":"\"w\""}]," ",["$","span",null,{"className":"token operator","children":"?"}]," ",["$","span",null,{"className":"token string","children":"\"100vw\""}]," ",["$","span",null,{"className":"token operator","children":":"}]," sizes",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    srcSet",["$","span",null,{"className":"token operator","children":":"}]," widths\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"map"}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["        ",["$","span",null,{"className":"token punctuation","children":"("}],"w",["$","span",null,{"className":"token punctuation","children":","}]," i",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}],"\n"]}],["$","span",null,{"className":"code-line","children":["          ",["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token template-punctuation string","children":"`"}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],["$","span",null,{"className":"token function","children":"loader"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}]," config",["$","span",null,{"className":"token punctuation","children":","}]," src",["$","span",null,{"className":"token punctuation","children":","}]," quality",["$","span",null,{"className":"token punctuation","children":","}]," width",["$","span",null,{"className":"token operator","children":":"}]," w ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token string","children":" "}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"\n"]}]]}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token template-string","children":["$","span",null,{"className":"token interpolation","children":["            kind ",["$","span",null,{"className":"token operator","children":"==="}]," ",["$","span",null,{"className":"token string","children":"\"w\""}]," ",["$","span",null,{"className":"token operator","children":"?"}]," w ",["$","span",null,{"className":"token operator","children":":"}]," i ",["$","span",null,{"className":"token operator","children":"+"}]," ",["$","span",null,{"className":"token number","children":"1"}],"\n"]}]}]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token template-string","children":[["$","span",null,{"className":"token interpolation","children":["          ",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token interpolation","children":[["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"$${"}],"kind",["$","span",null,{"className":"token interpolation-punctuation punctuation","children":"}"}]]}],["$","span",null,{"className":"token template-punctuation string","children":"`"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"join"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token string","children":"\", \""}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    src",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token function","children":"loader"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"{"}]," config",["$","span",null,{"className":"token punctuation","children":","}]," src",["$","span",null,{"className":"token punctuation","children":","}]," quality",["$","span",null,{"className":"token punctuation","children":","}]," width",["$","span",null,{"className":"token operator","children":":"}]," widths",["$","span",null,{"className":"token punctuation","children":"["}],"last",["$","span",null,{"className":"token punctuation","children":"]"}]," ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}]]}]}],"\n",["$","p",null,{"children":["$","strong",null,{"children":"return"}]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," props",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"ImgProps"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token spread operator","children":"..."}],"rest",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  loading",["$","span",null,{"className":"token operator","children":":"}]," isLazy ",["$","span",null,{"className":"token operator","children":"?"}]," ",["$","span",null,{"className":"token string","children":"\"lazy\""}]," ",["$","span",null,{"className":"token operator","children":":"}]," loading",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  fetchPriority",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  width",["$","span",null,{"className":"token operator","children":":"}]," widthInt",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  height",["$","span",null,{"className":"token operator","children":":"}]," heightInt",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  decoding",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  className",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  style",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],"imgStyle",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],"placeholderStyle ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  sizes",["$","span",null,{"className":"token operator","children":":"}]," imgAttributes",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"sizes"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  srcSet",["$","span",null,{"className":"token operator","children":":"}]," imgAttributes",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"srcSet"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["  src",["$","span",null,{"className":"token operator","children":":"}]," overrideSrc ",["$","span",null,{"className":"token operator","children":"||"}]," imgAttributes",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"src"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"const"}]," meta ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," unoptimized",["$","span",null,{"className":"token punctuation","children":","}]," priority",["$","span",null,{"className":"token punctuation","children":","}]," placeholder",["$","span",null,{"className":"token punctuation","children":","}]," fill ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," props",["$","span",null,{"className":"token punctuation","children":","}]," meta ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"이로써 최종 Image 컴포넌트로의 속성들이 결정된다."}],"\n"]}],"\n",["$","h2",null,{"id":"image","children":"<Image/>"}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"export"}]," ",["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token maybe-class-name","children":"Image"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token generic-function","children":[["$","span",null,{"className":"token function","children":"forwardRef"}],["$","span",null,{"className":"token generic class-name","children":[["$","span",null,{"className":"token operator","children":"<"}],"HTMLImageElement ",["$","span",null,{"className":"token operator","children":"|"}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":","}]," ImageProps",["$","span",null,{"className":"token operator","children":">"}]]}]]}],["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"("}],"props",["$","span",null,{"className":"token punctuation","children":","}]," forwardedRef",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"const"}]," isAppRouter ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token operator","children":"!"}],"pagesRouter\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"const"}]," configContext ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"useContext"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token maybe-class-name","children":"ImageConfigContext"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token comment","children":"// config를 가져옴"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"const"}]," config ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"useMemo"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"const"}]," c ",["$","span",null,{"className":"token operator","children":"="}]," configEnv ",["$","span",null,{"className":"token operator","children":"||"}]," configContext ",["$","span",null,{"className":"token operator","children":"||"}]," imageConfigDefault\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"const"}]," allSizes ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"["}],["$","span",null,{"className":"token spread operator","children":"..."}],"c",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"deviceSizes"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],"c",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"imageSizes"}],["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"sort"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"a",["$","span",null,{"className":"token punctuation","children":","}]," b",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," a ",["$","span",null,{"className":"token operator","children":"-"}]," b",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"const"}]," deviceSizes ",["$","span",null,{"className":"token operator","children":"="}]," c",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"deviceSizes"}],["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token method function property-access","children":"sort"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"a",["$","span",null,{"className":"token punctuation","children":","}]," b",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," a ",["$","span",null,{"className":"token operator","children":"-"}]," b",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"const"}]," qualities ",["$","span",null,{"className":"token operator","children":"="}]," c",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"qualities"}],["$","span",null,{"className":"token operator","children":"?."}],["$","span",null,{"className":"token method function property-access","children":"sort"}],["$","span",null,{"className":"token punctuation","children":"("}],["$","span",null,{"className":"token punctuation","children":"("}],"a",["$","span",null,{"className":"token punctuation","children":","}]," b",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token arrow operator","children":"=>"}]," a ",["$","span",null,{"className":"token operator","children":"-"}]," b",["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],"c",["$","span",null,{"className":"token punctuation","children":","}]," allSizes",["$","span",null,{"className":"token punctuation","children":","}]," deviceSizes",["$","span",null,{"className":"token punctuation","children":","}]," qualities ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token punctuation","children":"["}],"configContext",["$","span",null,{"className":"token punctuation","children":"]"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token keyword","children":"const"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}]," props",["$","span",null,{"className":"token operator","children":":"}]," imgAttributes",["$","span",null,{"className":"token punctuation","children":","}]," meta",["$","span",null,{"className":"token operator","children":":"}]," imgMeta ",["$","span",null,{"className":"token punctuation","children":"}"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token function","children":"getImgProps"}],["$","span",null,{"className":"token punctuation","children":"("}],"props",["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      defaultLoader",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      imgConf",["$","span",null,{"className":"token operator","children":":"}]," config",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      blurComplete",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["      showAltText",["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}],["$","span",null,{"className":"code-line","children":["   ",["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token spread operator","children":"..."}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":")"}],"\n"]}],["$","span",null,{"className":"code-line","children":"\n"}]]}]}],"\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token keyword","children":"return"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token tag","children":["$","span",null,{"className":"token punctuation","children":"<"}]}],["$","span",null,{"className":"token punctuation","children":">"}]]}],["$","span",null,{"className":"token plain-text","children":"\n"}]]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token plain-text","children":"    "}],["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"ImageElement"}]]}],"\n"]}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token spread","children":[["$","span",null,{"className":"token punctuation","children":"{"}],["$","span",null,{"className":"token spread operator","children":"..."}],"imgAttributes",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"unoptimized"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"imgMeta",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"unoptimized"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"placeholder"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"imgMeta",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"placeholder"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"fill"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"imgMeta",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"fill"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"onLoadRef"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"onLoadRef",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"onLoadingCompleteRef"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"onLoadingCompleteRef",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"setBlurComplete"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"setBlurComplete",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"setShowAltText"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"setShowAltText",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"sizesInput"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"props",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"sizes"}],["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token tag","children":["        ",["$","span",null,{"className":"token attr-name","children":"ref"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"forwardedRef",["$","span",null,{"className":"token punctuation","children":"}"}]]}],"\n"]}]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token tag","children":["      ",["$","span",null,{"className":"token punctuation","children":"/>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token plain-text","children":"\n"}]]}],["$","span",null,{"className":"code-line","children":["$","span",null,{"className":"token plain-text","children":"    // 미리 로드\n"}]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token plain-text","children":"    "}],["$","span",null,{"className":"token punctuation","children":"{"}],"imgMeta",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"priority"}]," ",["$","span",null,{"className":"token operator","children":"?"}]," ",["$","span",null,{"className":"token punctuation","children":"("}],"\n"]}],["$","span",null,{"className":"code-line","children":["      ",["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token punctuation","children":"<"}],["$","span",null,{"className":"token class-name","children":"ImagePreload"}]]}]," ",["$","span",null,{"className":"token attr-name","children":"isAppRouter"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"isAppRouter",["$","span",null,{"className":"token punctuation","children":"}"}]]}]," ",["$","span",null,{"className":"token attr-name","children":"imgAttributes"}],["$","span",null,{"className":"token script language-javascript","children":[["$","span",null,{"className":"token script-punctuation punctuation","children":"="}],["$","span",null,{"className":"token punctuation","children":"{"}],"imgAttributes",["$","span",null,{"className":"token punctuation","children":"}"}]]}]," ",["$","span",null,{"className":"token punctuation","children":"/>"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":["    ",["$","span",null,{"className":"token punctuation","children":")"}]," ",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token keyword","children":"null"}],["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token plain-text","children":"\n"}]]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token plain-text","children":"  "}],["$","span",null,{"className":"token tag","children":[["$","span",null,{"className":"token tag","children":["$","span",null,{"className":"token punctuation","children":"</"}]}],["$","span",null,{"className":"token punctuation","children":">"}]]}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":")"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["imgMeta.priority 속성을 활용해 Preload 판단을 하고, preload를 한다","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":"App router라면 ReactDom.Preload를 활용해 preload를 한다"}],"\n",["$","li",null,{"children":"아니라면, Head 컴포넌트를 사용하여 preload"}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","p",null,{"children":"번외"}],"\n",["$","h3",null,{"id":"image-캐싱-정책","children":"Image 캐싱 정책"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","strong",null,{"children":"이미지 캐싱 위치"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["이미지는 요청 시 실시간으로 최적화되며, 결과는 ",["$","code",null,{"children":"/.next/cache/images"}]," 폴더에 저장된다."]}],"\n",["$","li",null,{"children":"저장된 이미지는 만료될 때까지 반복해서 사용된다."}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"만료되었을 때"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["만료된 이미지 요청 시, ",["$","strong",null,{"children":"바로 이전 이미지(STALE)를 먼저 응답"}],"하고, ",["$","strong",null,{"children":"백그라운드에서 새로 최적화"}],"해서 캐시에 다시 저장한다 → ",["$","code",null,{"children":"revalidation"}]]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"응답 헤더로 캐시 상태 확인 가능"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"x-nextjs-cache"}]," 헤더 값으로 확인 가능:","\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"MISS"}],": 캐시에 없음 (첫 요청 시)"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"STALE"}],": 만료된 이미지지만 즉시 응답하고 백그라운드 재검증 중"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"HIT"}],": 유효한 캐시 이미지로 응답"]}],"\n"]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"캐시 만료 기준"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","code",null,{"children":"minimumCacheTTL"}],"과 원본 이미지의 ",["$","code",null,{"children":"Cache-Control"}]," 헤더의 ",["$","code",null,{"children":"max-age"}]," 중 ",["$","strong",null,{"children":"더 큰 값"}],"이 사용된다."]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"s-maxage"}],"가(CDN, proxy) 있으면 ",["$","code",null,{"children":"max-age"}],"보다 우선된다."]}],"\n",["$","li",null,{"children":"이 값은 CDN, 브라우저 등 downstream 클라이언트에게도 전달된다."}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"minimumCacheTTL 설정"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["기본값: ",["$","code",null,{"children":"60초"}]]}],"\n",["$","li",null,{"children":["설정 예:","\n",["$","pre",null,{"className":"language-tsx","children":["$","code",null,{"className":"language-tsx code-highlight","children":[["$","span",null,{"className":"code-line","children":["module",["$","span",null,{"className":"token punctuation","children":"."}],["$","span",null,{"className":"token property-access","children":"exports"}]," ",["$","span",null,{"className":"token operator","children":"="}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  images",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token punctuation","children":"{"}],"\n"]}],["$","span",null,{"className":"code-line","children":["    minimumCacheTTL",["$","span",null,{"className":"token operator","children":":"}]," ",["$","span",null,{"className":"token number","children":"2678400"}],["$","span",null,{"className":"token punctuation","children":","}]," ",["$","span",null,{"className":"token comment","children":"// 31일"}],"\n"]}],["$","span",null,{"className":"code-line","children":["  ",["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":","}],"\n"]}],["$","span",null,{"className":"code-line","children":[["$","span",null,{"className":"token punctuation","children":"}"}],["$","span",null,{"className":"token punctuation","children":";"}],"\n"]}]]}]}],"\n"]}],"\n",["$","li",null,{"children":"TTL(Time To Live - 캐시의 수명)이 낮으면 캐시 재검증이 자주 일어나지만 변경 사항 반영이 빠르다."}],"\n",["$","li",null,{"children":"TTL이 높으면 비용 절감에는 유리하지만 캐시 무효화가 어렵다."}],"\n"]}],"\n"]}],"\n",["$","li",null,{"children":[["$","strong",null,{"children":"주의 사항"}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["개별 이미지의 캐시를 무효화하려면 ",["$","code",null,{"children":"src"}],"를 변경하거나 ",["$","code",null,{"children":".next/cache/images"}]," 폴더를 직접 삭제"]}],"\n",["$","li",null,{"children":[["$","code",null,{"children":"/_next/image"}],"가 아닌 실제 원본 이미지(",["$","code",null,{"children":"/some-asset.jpg"}],")의 ",["$","code",null,{"children":"Cache-Control"}]," 헤더를 설정하여 캐시 전략을 개별적으로 제어할 수 있음."]}],"\n"]}],"\n"]}],"\n"]}],"\n",["$","h3",null,{"id":"vercel-배포-시-주의점20254월-기준","children":"Vercel 배포 시 주의점(2025.4월 기준)"}],"\n",["$","table",null,{"children":[["$","thead",null,{"children":["$","tr",null,{"children":[["$","th",null,{"children":"항목"}],["$","th",null,{"children":"hobby 포함"}],["$","th",null,{"children":"pro 포함"}],["$","th",null,{"children":"Pro/Enterprise 추가 요금"}]]}]}],["$","tbody",null,{"children":[["$","tr",null,{"children":[["$","td",null,{"children":"이미지 변환"}],["$","td",null,{"children":"5천 달러/월"}],["$","td",null,{"children":"1만 달러/월"}],["$","td",null,{"children":"1K당 $0.05 - $0.0812"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"이미지 캐시 읽기"}],["$","td",null,{"children":"30만/월"}],["$","td",null,{"children":"60만/월"}],["$","td",null,{"children":"1M당 $0.40 - $0.64"}]]}],["$","tr",null,{"children":[["$","td",null,{"children":"이미지 캐시 쓰기"}],["$","td",null,{"children":"10만/월"}],["$","td",null,{"children":"20만/월"}],["$","td",null,{"children":"1M당 $4.00 - $6.40"}]]}]]}]]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":[["$","a",null,{"href":"https://vercel.com/docs/image-optimization/limits-and-pricing#image-transformations","children":["$","strong",null,{"children":"이미지 변환"}]}]," , ",["$","a",null,{"href":"https://vercel.com/docs/image-optimization/limits-and-pricing#image-cache-reads","children":["$","strong",null,{"children":"이미지 캐시 읽기"}]}]," , ",["$","a",null,{"href":"https://vercel.com/docs/image-optimization/limits-and-pricing#image-cache-writes","children":["$","strong",null,{"children":"이미지 캐시 쓰기"}]}]," 횟수에 따라 요금이 청구된다 ."]}],"\n"]}],"\n",["$","p",null,{"children":[["$","a",null,{"href":"https://vercel.com/docs/image-optimization#measuring-performance","children":["$","strong",null,{"children":"Vercel에서 최적화된"}]}]," 모든 이미지에는 다음과 같은 제한이 적용된다."]}],"\n",["$","ul",null,{"children":["\n",["$","li",null,{"children":["변환된 이미지의 최대 크기는 ",["$","a",null,{"href":"https://vercel.com/docs/edge-network/caching#how-to-cache-responses","children":["$","strong",null,{"children":"캐시 가능한 응답 제한"}]}]," 에 명시된 대로 ",["$","strong",null,{"children":"10MB"}]]}],"\n",["$","li",null,{"children":"각 소스 이미지의 최대 너비와 높이는 8192픽셀이다."}],"\n",["$","li",null,{"children":["최적화하려면 원본 이미지가 다음 형식 중 하나여야 한다. ",["$","code",null,{"children":"image/jpeg, image/png, image/webp, image/avif"}]]}],"\n"]}]]}],["$","hr",null,{"className":"my-10"}],["$","$Lf",null,{}]]
e:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}],["$","meta","1",{"charSet":"utf-8"}],["$","title","2",{"children":"Next.js Image 어떻게 최적화 할까?"}],["$","meta","3",{"name":"description","content":"Image 최적화 과정과 Canary 버전에서 확인해보는 신기능?도 있었다."}],["$","meta","4",{"name":"keywords","content":"gogleset,Next,Image"}],["$","meta","5",{"property":"og:title","content":"Next.js Image 어떻게 최적화 할까?"}],["$","meta","6",{"property":"og:description","content":"Image 최적화 과정과 Canary 버전에서 확인해보는 신기능?도 있었다."}],["$","meta","7",{"property":"og:site_name","content":"https://gogleset.github.io"}],["$","meta","8",{"property":"og:type","content":"website"}],["$","meta","9",{"name":"twitter:card","content":"summary"}],["$","meta","10",{"name":"twitter:title","content":"Next.js Image 어떻게 최적화 할까?"}],["$","meta","11",{"name":"twitter:description","content":"Image 최적화 과정과 Canary 버전에서 확인해보는 신기능?도 있었다."}],["$","link","12",{"rel":"icon","href":"/favicon-32x32.png"}],["$","link","13",{"rel":"apple-touch-icon","href":"/apple-touch-icon.png"}]]
1:null
